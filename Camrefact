SELECT COUNT(*) 

FROM CAMBUSVW.ITEMEVENTFACT ief

LEFT OUTER JOIN CAMBUSVW.AGENTBRANCH ab ON ief.AGENTBRANCHDIMENSIONID = ab.AGENTBRANCHDIMENSIONID

LEFT OUTER JOIN CAMBUSVW.COUNTRY c ON ief.COUNTRYDIMENSIONID = c.COUNTRYDIMENSIONID

LEFT OUTER JOIN CAMBUSVW.CLIENT c2 ON ief.CLIENTDIMENSIONID = c2.CLIENTDIMENSIONID

LEFT OUTER JOIN CAMBUSVW.ITEM i ON ief.ITEMDIMENSIONID = i.ITEMDIMENSIONID

LEFT OUTER JOIN CAMBUSVW.PERSON p ON ief.PERSONDIMENSIONID = p.PERSOMDIMENSIONID

LEFT OUTER JOIN CAMBUSVW.CHANNEL ch ON ief.CHANNELDIMENSIONID = ch.CHANNELDIMENSIONID

LEFT OUTER JOIN CAMBUSVW.BUSINESSEVENT be ON ief.BUSINESSEVENTDIMENSIONID = be.BUSINESSEVENTDIMENSIONID

LEFT OUTER JOIN CAMBUSVW.BUSINESSEVENTSOURCE bes ON ief.BUSINESSEVENTSOURCEDIMENSIONID = bes.BUSINESSEVENTSOURCEDIMENSIONID

WHERE c.COUNTRYCODE IN ('GBR', 'UK')

AND i.ITEMATOWNERSRESIDENCEFLAG = 'Y'

AND (i.ITEMOPERATIONALSTATUSCODE <> 'N' OR i.ITEMOPERATIONALSTATUSCODE IS NULL)

AND ((c2.CLIENTGROUPNAME = 'HOOVER CANDY GROUP' AND c2.CLIENTNAME IN ('HOOVER', 'CANDY', 'HOOVERCARE')) OR (c2.CLIENTGROUPNAME = 'D&G' AND c2.CLIENTNAME = 'D&G'))

AND i.ITEMCOVERMANUFACTURERGUARANTEELABOURMONTHS = 12

AND (((ch.CHANNELNAME = 'ECOMMERCE' OR ch.CHANNELNAME LIKE 'GENIO%') AND be.BUSINESSEVENTCODE = 'REG' AND bes.BUSINESSEVENTSOURCECODE = 'TEL') 

     OR (ch.CHANNELNAME IN ('OLR', 'ECOMMERCE', 'AMDEA') AND be.BUSINESSEVENTCODE = 'REG' AND bes.BUSINESSEVENTSOURCECODE = 'OLR' AND NOT ief.RECEIVEDDATEDIMENSIONID BETWEEN 20180501 AND 20180930))

AND NOT ab.AGENTCODE IN ('72768', '72770')

AND i.ITEMPURCHASEDATETIME > (CURRENT_DATE - 560)

AND i.ITEMGOODSCATEGORYCODE = 'W';

